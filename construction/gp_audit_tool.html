<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GP Audit Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 800px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        input {
            width: 100%;
            border: none;
            padding: 5px;
        }
        .target-gp {
            width: calc(4ch + 20px); /* Increased by 20 pixels */
            background-color: #90ee90; /* Light green color */
        }
        .total {
            font-weight: bold;
            background-color: #e6e6e6;
        }
        .blended-gp {
            margin-top: 20px;
            font-weight: bold;
        }
        .footer-text {
            margin-top: 20px;
            font-size: 14px;
            line-height: 1.5;
            color: #333;
            max-width: 800px; /* Matches table width */
            text-align: left;
        }
    </style>
</head>
<body>
    <h1>GP Audit Tool</h1>
    <label for="target-gp">Enter Target GP%:</label>
    <input type="number" id="target-gp" class="target-gp" step="0.01" placeholder="Enter Target GP%" oninput="updateGMInputs()">
    <br>
    <a href="https://ikegilbert.github.io/public/gp_audit.instructions.html" target="_blank" onclick="window.open(this.href, 'popup', 'width=600,height=500'); return false;">Instructions</a>
    <br><br>

    <!-- Cost Table -->
    <table id="cost-table">
        <thead>
            <tr>
                <th>COST</th>
                <th>GM %</th>
                <th>SELL</th>
                <th>MARKUP</th>
                <th>MU%</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="number" class="cost" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="gm" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="sell" step="0.01" oninput="calculateRow(this)"></td>
                <td class="markup"></td>
                <td class="mu-percent"></td>
            </tr>
            <tr>
                <td><input type="number" class="cost" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="gm" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="sell" step="0.01" oninput="calculateRow(this)"></td>
                <td class="markup"></td>
                <td class="mu-percent"></td>
            </tr>
            <tr>
                <td><input type="number" class="cost" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="gm" step="0.01" oninput="calculateRow(this)"></td>
                <td><input type="number" class="sell" step="0.01" oninput="calculateRow(this)"></td>
                <td class="markup"></td>
                <td class="mu-percent"></td>
            </tr>
            <tr class="total">
                <td id="total-cost">0</td>
                <td></td>
                <td id="total-sell">0</td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>

    <br><br>

    <!-- Sell Table -->
    <table id="sell-table">
        <thead>
            <tr>
                <th>SELL</th>
                <th>COST</th>
                <th>MARKUP</th>
                <th>PROFIT GROSS</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="number" class="sell2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td><input type="number" class="cost2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td class="markup2"></td>
                <td class="profit-gross"></td>
            </tr>
            <tr>
                <td><input type="number" class="sell2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td><input type="number" class="cost2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td class="markup2"></td>
                <td class="profit-gross"></td>
            </tr>
            <tr>
                <td><input type="number" class="sell2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td><input type="number" class="cost2" step="0.01" oninput="calculateSellRow(this)"></td>
                <td class="markup2"></td>
                <td class="profit-gross"></td>
            </tr>
            <tr class="total">
                <td id="total-sell2">0</td>
                <td id="total-cost2">0</td>
                <td></td>
                <td id="total-profit-gross">0</td>
            </tr>
        </tbody>
    </table>

    <div class="blended-gp">
        BLENDED GP%: <span id="blended-gp">0</span>
    </div>

    <div class="footer-text">
        This online tool is designed to help small businesses and contractors determine the appropriate markup to resell goods and services. In order to make the desired profits, use these steps to plan your estimates or sales quickly.
    </div>

    <script>
        function updateGMInputs() {
            const targetGP = parseFloat(document.getElementById('target-gp').value) || 0;
            document.querySelectorAll('#cost-table .gm').forEach(gmInput => {
                gmInput.value = targetGP.toFixed(2);
                calculateRow(gmInput);
            });
        }

        function calculateRow(element) {
            const row = element.parentElement.parentElement;
            const costInput = row.querySelector('.cost');
            const gmInput = row.querySelector('.gm');
            const sellInput = row.querySelector('.sell');
            const markupCell = row.querySelector('.markup');
            const muPercentCell = row.querySelector('.mu-percent');

            let cost = parseFloat(costInput.value) || 0;
            let gm = parseFloat(gmInput.value) || 0;
            let sell = parseFloat(sellInput.value) || 0;

            if (element.classList.contains('cost') && cost !== 0) {
                // Calculate SELL from COST and GM%
                sell = cost / (1 - gm / 100);
                sellInput.value = sell.toFixed(2);
            } else if (element.classList.contains('gm') && gm !== 0) {
                // Calculate SELL from COST and GM%
                sell = cost / (1 - gm / 100);
                sellInput.value = sell.toFixed(2);
            } else if (element.classList.contains('sell') && sell !== 0) {
                // Calculate GM% from COST and SELL
                gm = ((sell - cost) / sell) * 100;
                gmInput.value = gm.toFixed(2);
            }

            // Calculate MARKUP and MU%
            const markup = sell - cost;
            const muPercent = cost !== 0 ? (markup / cost) * 100 : 0;

            markupCell.textContent = markup.toFixed(2);
            muPercentCell.textContent = muPercent.toFixed(2) + '%';

            calculateTotals();
        }

        function calculateSellRow(element) {
            const row = element.parentElement.parentElement;
            const sellInput = row.querySelector('.sell2');
            const costInput = row.querySelector('.cost2');
            const markupCell = row.querySelector('.markup2');
            const profitGrossCell = row.querySelector('.profit-gross');

            let sell = parseFloat(sellInput.value) || 0;
            let cost = parseFloat(costInput.value) || 0;

            // Calculate MARKUP
            const markup = sell - cost;
            markupCell.textContent = markup.toFixed(2);

            // Calculate PROFIT GROSS (GM%)
            const profitGross = sell !== 0 ? (sell - cost) / sell : 0;
            profitGrossCell.textContent = profitGross.toFixed(6);

            calculateSellTotals();
        }

        function calculateTotals() {
            let totalCost = 0;
            let totalSell = 0;

            document.querySelectorAll('#cost-table .cost').forEach(input => {
                totalCost += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('#cost-table .sell').forEach(input => {
                totalSell += parseFloat(input.value) || 0;
            });

            document.getElementById('total-cost').textContent = totalCost.toFixed(2);
            document.getElementById('total-sell').textContent = totalSell.toFixed(2);

            calculateBlendedGP();
        }

        function calculateSellTotals() {
            let totalSell = 0;
            let totalCost = 0;
            let totalProfitGross = 0;

            document.querySelectorAll('#sell-table .sell2').forEach(input => {
                totalSell += parseFloat(input.value) || 0;
            });
            document.querySelectorAll('#sell-table .cost2').forEach(input => {
                totalCost += parseFloat(input.value) || 0;
            });

            totalProfitGross = totalSell !== 0 ? (totalSell - totalCost) / totalSell : 0;

            document.getElementById('total-sell2').textContent = totalSell.toFixed(2);
            document.getElementById('total-cost2').textContent = totalCost.toFixed(2);
            document.getElementById('total-profit-gross').textContent = totalProfitGross.toFixed(6);

            calculateBlendedGP();
        }

        function calculateBlendedGP() {
            const totalSell = parseFloat(document.getElementById('total-sell2').textContent) || 0;
            const totalCost = parseFloat(document.getElementById('total-cost2').textContent) || 0;
            const blendedGP = totalSell !== 0 ? ((totalSell - totalCost) / totalSell) : 0;
            document.getElementById('blended-gp').textContent = blendedGP.toFixed(6);
        }
    </script>
</body>
</html>
